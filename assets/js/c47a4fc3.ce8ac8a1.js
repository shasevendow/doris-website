"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[43446],{15680:(e,n,a)=>{a.d(n,{xA:()=>m,yg:()=>g});var t=a(296540);function r(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function i(e,n){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var t=Object.getOwnPropertySymbols(e);n&&(t=t.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),a.push.apply(a,t)}return a}function l(e){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?i(Object(a),!0).forEach((function(n){r(e,n,a[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(a,n))}))}return e}function o(e,n){if(null==e)return{};var a,t,r=function(e,n){if(null==e)return{};var a,t,r={},i=Object.keys(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||(r[a]=e[a]);return r}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(t=0;t<i.length;t++)a=i[t],n.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=t.createContext({}),d=function(e){var n=t.useContext(s),a=n;return e&&(a="function"==typeof e?e(n):l(l({},n),e)),a},m=function(e){var n=d(e.components);return t.createElement(s.Provider,{value:n},e.children)},u="mdxType",c={inlineCode:"code",wrapper:function(e){var n=e.children;return t.createElement(t.Fragment,{},n)}},p=t.forwardRef((function(e,n){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,m=o(e,["components","mdxType","originalType","parentName"]),u=d(a),p=r,g=u["".concat(s,".").concat(p)]||u[p]||c[p]||i;return a?t.createElement(g,l(l({ref:n},m),{},{components:a})):t.createElement(g,l({ref:n},m))}));function g(e,n){var a=arguments,r=n&&n.mdxType;if("string"==typeof e||r){var i=a.length,l=new Array(i);l[0]=p;var o={};for(var s in n)hasOwnProperty.call(n,s)&&(o[s]=n[s]);o.originalType=e,o[u]="string"==typeof e?e:r,l[1]=o;for(var d=2;d<i;d++)l[d]=a[d];return t.createElement.apply(null,l)}return t.createElement.apply(null,a)}p.displayName="MDXCreateElement"},4322:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>s,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>o,toc:()=>d});var t=a(58168),r=(a(296540),a(15680));const i={title:"Inverted Index",language:"en"},l=void 0,o={unversionedId:"table-design/index/inverted-index",id:"version-2.1/table-design/index/inverted-index",title:"Inverted Index",description:"\x3c!--",source:"@site/versioned_docs/version-2.1/table-design/index/inverted-index.md",sourceDirName:"table-design/index",slug:"/table-design/index/inverted-index",permalink:"/docs/table-design/index/inverted-index",draft:!1,tags:[],version:"2.1",frontMatter:{title:"Inverted Index",language:"en"},sidebar:"docs",previous:{title:"Bitmap Index",permalink:"/docs/table-design/index/bitmap-index"},next:{title:"Using AUTO_INCREMENT",permalink:"/docs/table-design/auto-increment"}},s={},d=[{value:"Glossary",id:"glossary",level:2},{value:"Basic principles",id:"basic-principles",level:2},{value:"Features",id:"features",level:2},{value:"Syntax",id:"syntax",level:2},{value:"Examples",id:"examples",level:2},{value:"Create Table",id:"create-table",level:3},{value:"Load data",id:"load-data",level:3},{value:"Query",id:"query",level:3},{value:"Fulltext Search Query",id:"fulltext-search-query",level:4},{value:"Normal equal, range query",id:"normal-equal-range-query",level:4}],m={toc:d},u="wrapper";function c(e){let{components:n,...a}=e;return(0,r.yg)(u,(0,t.A)({},m,a,{components:n,mdxType:"MDXLayout"}),(0,r.yg)("p",null,"From version 2.0, Doris implemented inverted index to support fulltext search on text field, normal eq and range filter on text, numeric, datetime field. This doc introduce inverted index usage, including create, drop and query."),(0,r.yg)("h2",{id:"glossary"},"Glossary"),(0,r.yg)("p",null,(0,r.yg)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Inverted_index"},"inverted index")," is a index techlogy used in information retirval commonly. It split text into word terms and construct a term to doc index. This index is called inverted index and can be used to find the docs where a specific term appears."),(0,r.yg)("h2",{id:"basic-principles"},"Basic principles"),(0,r.yg)("p",null,"In the inverted index of Doris, a row in a table corresponds to a doc in CLucene, a column corresponds to a field in doc. So using inverted index, doris can get the rows that meet the filter of SQL WHERE clause, and then get the rows quickly without reading other unrelated rows."),(0,r.yg)("p",null,"Doris use a seperate file to store inverted index. It's related to segment file in logic, but iosolated with each other. The advantange is that, create and drop inverted index does not need to rewrite tablet and segment file, which is very heavy work."),(0,r.yg)("h2",{id:"features"},"Features"),(0,r.yg)("p",null,"The features for inverted index is as follows:"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"add fulltext search on text(string, varchar, char) field",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"MATCH_ALL matches all keywords, MATCH_ANY matches any keywords"),(0,r.yg)("li",{parentName:"ul"},"Support for phrase query MATCH_PHRASE"),(0,r.yg)("li",{parentName:"ul"},"Support for phrase + prefix MATCH_PHRASE_PREFIX"),(0,r.yg)("li",{parentName:"ul"},"Support for regular expression query MATCH_REGEXP"),(0,r.yg)("li",{parentName:"ul"},"support fulltext on array of text field"),(0,r.yg)("li",{parentName:"ul"},"support english, chinese and mixed unicode word parser"))),(0,r.yg)("li",{parentName:"ul"},"accelerate normal equal, range query, replacing bitmap index",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"suport =, !=, >, >=, <, <= on text, numeric, datetime types"),(0,r.yg)("li",{parentName:"ul"},"suport =, !=, >, >=, <, <= on array of text, numeric, datetime types"))),(0,r.yg)("li",{parentName:"ul"},"complete suport for logic combination",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"add index filter push down for OR, NOT"),(0,r.yg)("li",{parentName:"ul"},"support combination of AND, OR, NOT"))),(0,r.yg)("li",{parentName:"ul"},"flexiable and fast index management",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"support inverted index definition on table creation"),(0,r.yg)("li",{parentName:"ul"},"support add inverted index on existed table, without rewrite data"),(0,r.yg)("li",{parentName:"ul"},"support delete inverted index on existed table, without rewrite data")))),(0,r.yg)("h2",{id:"syntax"},"Syntax"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"The inverted index definition syntax on table creation is as follows"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"USING INVERTED is mandatory, it specify index type to be inverted index")),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"PROPERTIES is optional, it allows user to specify additional properties for index. Currently, there are three types of properties available."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},'"parser" is utilized to set the type of tokenizer/parser'),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"missing stands for no parser, the whole field is considered to be a term"),(0,r.yg)("li",{parentName:"ul"},'"english" stands for english parser'),(0,r.yg)("li",{parentName:"ul"},'"chinese" stands for chinese parser'),(0,r.yg)("li",{parentName:"ul"},'"unicode" stands for muti-language mixed word segmentation suitable for situations with a mix of Chinese and English. It can segment email prefixes and suffixes, IP addresses, and mixed characters and numbers, and can also segment Chinese characters one by one.'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},'"parser_mode" is utilized to set the tokenizer/parser type for Chinese word segmentation.'),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"in \"fine_grained\" mode, the system tend to generate short words, eg. 6 words '\u6b66\u6c49' '\u6b66\u6c49\u5e02' '\u5e02\u957f' '\u957f\u6c5f' '\u957f\u6c5f\u5927\u6865' '\u5927\u6865' for '\u6b66\u6c49\u957f\u6c5f\u5927\u6865'."),(0,r.yg)("li",{parentName:"ul"},"in \"coarse_grained\" mode, the system tend to generate long words, eg. 2 words '\u6b66\u6c49\u5e02' '\u5e02\u957f' '\u957f\u6c5f\u5927\u6865' for '\u6b66\u6c49\u957f\u6c5f\u5927\u6865'."),(0,r.yg)("li",{parentName:"ul"},'default mode is "coarse_grained".'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},'"support_phrase" is utilized to specify if the index requires support for phrase mode query MATCH_PHRASE'),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},'"true" indicates that support is needed, but needs more storage for index.'),(0,r.yg)("li",{parentName:"ul"},'"false" indicates that support is not needed, and less storage for index. MATCH_ALL can be used for matching multi words without order.'),(0,r.yg)("li",{parentName:"ul"},'default mode is "false".'))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"char_filter: the main function is to pre-process the string before word segmentation"),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"char_filter_type: specify char_filters with different functions (currently only char_replace is supported)",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"char_replace: replace each char in the pattern with a char in the replacement",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"char_filter_pattern: character array to be replaced"),(0,r.yg)("li",{parentName:"ul"},"char_filter_replacement: replaced character array, can be left unset, defaults to a space character"))))))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"ignore_above: Controls whether strings are indexed."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"Strings longer than the ignore_above setting will not be indexed. For arrays of strings, ignore_above will be applied for each array element separately and string elements longer than ignore_above will not be indexed."),(0,r.yg)("li",{parentName:"ul"},"default value is 256 bytes."))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"lower_case: Whether to convert tokens to lowercase, thereby achieving case-insensitive matching."),(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"true: Convert to lowercase"),(0,r.yg)("li",{parentName:"ul"},"false: Do not convert to lowercase "))))),(0,r.yg)("li",{parentName:"ul"},(0,r.yg)("p",{parentName:"li"},"COMMENT is optional"))))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE table_name\n(\n  columns_difinition,\n  INDEX idx_name1(column_name1) USING INVERTED [PROPERTIES("parser" = "english|chinese|unicode")] [COMMENT \'your comment\']\n  INDEX idx_name2(column_name2) USING INVERTED [PROPERTIES("parser" = "english|chinese|unicode")] [COMMENT \'your comment\']\n  INDEX idx_name3(column_name3) USING INVERTED [PROPERTIES("parser" = "chinese", "parser_mode" = "fine_grained|coarse_grained")] [COMMENT \'your comment\']\n  INDEX idx_name4(column_name4) USING INVERTED [PROPERTIES("parser" = "english|chinese|unicode", "support_phrase" = "true|false")] [COMMENT \'your comment\']\n  INDEX idx_name5(column_name4) USING INVERTED [PROPERTIES("char_filter_type" = "char_replace", "char_filter_pattern" = "._"), "char_filter_replacement" = " "] [COMMENT \'your comment\']\n  INDEX idx_name5(column_name4) USING INVERTED [PROPERTIES("char_filter_type" = "char_replace", "char_filter_pattern" = "._")] [COMMENT \'your comment\']\n)\ntable_properties;\n')),(0,r.yg)("admonition",{type:"tip"},(0,r.yg)("p",{parentName:"admonition"},"Inverted indexes have different limitations in different data models:"),(0,r.yg)("ul",{parentName:"admonition"},(0,r.yg)("li",{parentName:"ul"},"Aggregate model: Inverted indexes can only be created for the Key column."),(0,r.yg)("li",{parentName:"ul"},"Unique model: The merge on write feature needs to be enabled. After enabling it, an inverted index can be created for any column."),(0,r.yg)("li",{parentName:"ul"},"Duplicate model: An inverted index can be created for any column."))),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"add an inverted index to existed table")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"Before version 2.0.0:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'-- syntax 1\nCREATE INDEX idx_name ON table_name(column_name) USING INVERTED [PROPERTIES("parser" = "english|chinese|unicode")] [COMMENT \'your comment\'];\n-- syntax 2\nALTER TABLE table_name ADD INDEX idx_name(column_name) USING INVERTED [PROPERTIES("parser" = "english|chinese|unicode")] [COMMENT \'your comment\'];\n')),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"After version 2.0.0 (including 2.0.0):")),(0,r.yg)("p",null,"The above 'create/add index' operation only generates inverted index for incremental data. The syntax of BUILD INDEX is added to add inverted index to stock data:"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- syntax 1, add inverted index to the stock data of the whole table by default\nBUILD INDEX index_name ON table_name;\n-- syntax 2, partition can be specified, and one or more can be specified\nBUILD INDEX index_name ON table_name PARTITIONS(partition_name1, partition_name2);\n")),(0,r.yg)("p",null,"(",(0,r.yg)("strong",{parentName:"p"},"The above 'create/add index' operation needs to be executed before executing the BUILD INDEX"),")"),(0,r.yg)("p",null,"To view the progress of the ",(0,r.yg)("inlineCode",{parentName:"p"},"BUILD INDEX"),", you can run the following statement"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'SHOW BUILD INDEX [FROM db_name];\n-- Example 1: Viewing the progress of all BUILD INDEX tasks\nSHOW BUILD INDEX;\n-- Example 2: Viewing the progress of the BUILD INDEX task for a specified table\nSHOW BUILD INDEX where TableName = "table1";\n')),(0,r.yg)("p",null,"To cancel ",(0,r.yg)("inlineCode",{parentName:"p"},"BUILD INDEX"),", you can run the following statement"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"CANCEL BUILD INDEX ON table_name;\nCANCEL BUILD INDEX ON table_name (job_id1,jobid_2,...);\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"drop an inverted index")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- syntax 1\nDROP INDEX idx_name ON table_name;\n-- syntax 2\nALTER TABLE table_name DROP INDEX idx_name;\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"speed up query using inverted index")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- 1. fulltext search using MATCH_ANY OR MATCH_ALL\nSELECT * FROM table_name WHERE column_name MATCH_ANY | MATCH_ALL 'keyword1 ...';\n\n-- 1.1 find rows that logmsg contains keyword1\nSELECT * FROM table_name WHERE logmsg MATCH_ANY 'keyword1';\n\n-- 1.2 find rows that logmsg contains keyword1 or keyword2 or more keywords\nSELECT * FROM table_name WHERE logmsg MATCH_ANY 'keyword1 keyword2';\n\n-- 1.3 find rows that logmsg contains both keyword1 and keyword2 and more keywords\nSELECT * FROM table_name WHERE logmsg MATCH_ALL 'keyword1 keyword2';\n\n-- 1.4 When not specifying a slop for a phrase query, the default slop is 0, meaning \"keyword1 keyword2\" must be adjacent. You can specify the slop for a phrase query using the tilde (~) symbol.\nSELECT * FROM table_name WHERE logmsg MATCH_PHRASE 'keyword1 keyword2';\nSELECT * FROM table_name WHERE logmsg MATCH_PHRASE 'keyword1 keyword2 ~3';\n\n-- 1.5 Under the premise of maintaining word order, perform prefix matching on the last word \"keyword2\", and default to finding 50 prefix words (controlled by the session variable \"inverted_index_max_expansions\").\nSELECT * FROM table_name WHERE logmsg MATCH_PHRASE_PREFIX 'keyword1 keyword2';\n\n-- 1.6 If only one word is provided, it will revert to a prefix query, and default to finding 50 prefix words (controlled by the session variable \"inverted_index_max_expansions\").\nSELECT * FROM table_name WHERE logmsg MATCH_PHRASE_PREFIX 'keyword1';\n\n-- 1.7 Perform regular expression matching on the segmented words, and default to matching 50 words (controlled by the session variable \"inverted_index_max_expansions\").\nSELECT * FROM table_name WHERE logmsg MATCH_REGEXP 'key*';\n\n-- 2. normal equal, range query\nSELECT * FROM table_name WHERE id = 123;\nSELECT * FROM table_name WHERE ts > '2023-01-01 00:00:00';\nSELECT * FROM table_name WHERE op_type IN ('add', 'delete');\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Tokenization Function")),(0,r.yg)("p",null,"To evaluate the actual effects of tokenization or to tokenize a block of text, the ",(0,r.yg)("inlineCode",{parentName:"p"},"tokenize")," function can be utilized."),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'mysql> SELECT TOKENIZE(\'\u6b66\u6c49\u957f\u6c5f\u5927\u6865\',\'"parser"="chinese","parser_mode"="fine_grained");\n+-----------------------------------------------------------------------------------+\n| tokenize(\'\u6b66\u6c49\u957f\u6c5f\u5927\u6865\', \'"parser"="chinese","parser_mode"="fine_grained"\')       |\n+-----------------------------------------------------------------------------------+\n| ["\u6b66\u6c49", "\u6b66\u6c49\u957f\u6c5f\u5927\u6865", "\u957f\u6c5f", "\u957f\u6c5f\u5927\u6865", "\u5927\u6865"]                              |\n+-----------------------------------------------------------------------------------+\n1 row in set (0.02 sec)\n\nmysql> SELECT TOKENIZE(\'\u6b66\u6c49\u5e02\u957f\u6c5f\u5927\u6865\',\'"parser"="chinese","parser_mode"="fine_grained");\n+--------------------------------------------------------------------------------------+\n| tokenize(\'\u6b66\u6c49\u5e02\u957f\u6c5f\u5927\u6865\', \'"parser"="chinese","parser_mode"="fine_grained"\')        |\n+--------------------------------------------------------------------------------------+\n| ["\u6b66\u6c49", "\u6b66\u6c49\u5e02", "\u5e02\u957f", "\u957f\u6c5f", "\u957f\u6c5f\u5927\u6865", "\u5927\u6865"]                               |\n+--------------------------------------------------------------------------------------+\n1 row in set (0.02 sec)\n\nmysql> SELECT TOKENIZE(\'\u6b66\u6c49\u5e02\u957f\u6c5f\u5927\u6865\',\'"parser"="chinese","parser_mode"="coarse_grained");\n+----------------------------------------------------------------------------------------+\n| tokenize(\'\u6b66\u6c49\u5e02\u957f\u6c5f\u5927\u6865\', \'"parser"="chinese","parser_mode"="coarse_grained"\')        |\n+----------------------------------------------------------------------------------------+\n| ["\u6b66\u6c49\u5e02", "\u957f\u6c5f\u5927\u6865"]                                                                 |\n+----------------------------------------------------------------------------------------+\n1 row in set (0.02 sec)\n\nmysql> SELECT TOKENIZE(\'I love CHINA\',\'"parser"="english");\n+------------------------------------------------+\n| tokenize(\'I love CHINA\', \'"parser"="english"\') |\n+------------------------------------------------+\n| ["i", "love", "china"]                         |\n+------------------------------------------------+\n1 row in set (0.02 sec)\n\nmysql> SELECT TOKENIZE(\'I love CHINA \u6211\u7231\u6211\u7684\u7956\u56fd\',\'"parser"="unicode");\n+-------------------------------------------------------------------+\n| tokenize(\'I love CHINA \u6211\u7231\u6211\u7684\u7956\u56fd\', \'"parser"="unicode"\')       |\n+-------------------------------------------------------------------+\n| ["i", "love", "china", "\u6211", "\u7231", "\u6211", "\u7684", "\u7956", "\u56fd"]        |\n+-------------------------------------------------------------------+\n1 row in set (0.02 sec)\n')),(0,r.yg)("h2",{id:"examples"},"Examples"),(0,r.yg)("p",null,"This example will demostrate inverted index creation, fulltext query, normal query using a hackernews dataset with 1 million rows. The performanc comparation between using  and without inverted index will also be showed."),(0,r.yg)("h3",{id:"create-table"},"Create Table"),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},'\nCREATE DATABASE test_inverted_index;\n\nUSE test_inverted_index;\n\n-- define inverted index idx_comment for comment column on table creation\n--   USING INVERTED specify using inverted index\n--   PROPERTIES("parser" = "english") specify english word parser\nCREATE TABLE hackernews_1m\n(\n    `id` BIGINT,\n    `deleted` TINYINT,\n    `type` String,\n    `author` String,\n    `timestamp` DateTimeV2,\n    `comment` String,\n    `dead` TINYINT,\n    `parent` BIGINT,\n    `poll` BIGINT,\n    `children` Array<BIGINT>,\n    `url` String,\n    `score` INT,\n    `title` String,\n    `parts` Array<INT>,\n    `descendants` INT,\n    INDEX idx_comment (`comment`) USING INVERTED PROPERTIES("parser" = "english") COMMENT \'inverted index for comment\'\n)\nDUPLICATE KEY(`id`)\nDISTRIBUTED BY HASH(`id`) BUCKETS 10\nPROPERTIES ("replication_num" = "1");\n\n')),(0,r.yg)("h3",{id:"load-data"},"Load data"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"load data by stream load")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre"},'\nwget https://doris-build-1308700295.cos.ap-beijing.myqcloud.com/regression/index/hacknernews_1m.csv.gz\n\ncurl --location-trusted -u root: -H "compress_type:gz" -T hacknernews_1m.csv.gz  http://127.0.0.1:8030/api/test_inverted_index/hackernews_1m/_stream_load\n{\n    "TxnId": 2,\n    "Label": "a8a3e802-2329-49e8-912b-04c800a461a6",\n    "TwoPhaseCommit": "false",\n    "Status": "Success",\n    "Message": "OK",\n    "NumberTotalRows": 1000000,\n    "NumberLoadedRows": 1000000,\n    "NumberFilteredRows": 0,\n    "NumberUnselectedRows": 0,\n    "LoadBytes": 130618406,\n    "LoadTimeMs": 8988,\n    "BeginTxnTimeMs": 23,\n    "StreamLoadPutTimeMs": 113,\n    "ReadDataTimeMs": 4788,\n    "WriteDataTimeMs": 8811,\n    "CommitAndPublishTimeMs": 38\n}\n')),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"check loaded data by SQL count()")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m;\n+---------+\n| count() |\n+---------+\n| 1000000 |\n+---------+\n1 row in set (0.02 sec)\n")),(0,r.yg)("h3",{id:"query"},"Query"),(0,r.yg)("h4",{id:"fulltext-search-query"},"Fulltext Search Query"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"count the rows that comment contains 'OLAP' using LIKE, cost 0.18s")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%';\n+---------+\n| count() |\n+---------+\n|      34 |\n+---------+\n1 row in set (0.18 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"count the rows that comment contains 'OLAP' using MATCH_ANY fulltext search based on inverted index , cost 0.02s and 9x speedup, the speedup will be even larger on larger dataset",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"the difference of count is due to feature of fulltext. Word parser will not only split text to words, but also do some normalization such transform to lower case letters. So the result of MATCH_ANY will be a little more.")))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLAP';\n+---------+\n| count() |\n+---------+\n|      35 |\n+---------+\n1 row in set (0.02 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"Semilarly, count on 'OLTP' shows 0.07s vs 0.01s. Due to the cache in Doris, both LIKE and MATCH_ANY is faster, but there is still 7x speedup.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      48 |\n+---------+\n1 row in set (0.07 sec)\n\nmysql> SELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLTP';\n+---------+\n| count() |\n+---------+\n|      51 |\n+---------+\n1 row in set (0.01 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"search for both 'OLAP' and 'OLTP', 0.13s vs 0.01s\uff0c13x speedup",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"using MATCH_ALL if you need the keywords all appears")))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%' AND comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      14 |\n+---------+\n1 row in set (0.13 sec)\n\nmysql> SELECT count() FROM hackernews_1m WHERE comment MATCH_ALL 'OLAP OLTP';\n+---------+\n| count() |\n+---------+\n|      15 |\n+---------+\n1 row in set (0.01 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"search for at least one of 'OLAP' or 'OLTP', 0.12s vs 0.01s\uff0c12x speedup",(0,r.yg)("ul",{parentName:"li"},(0,r.yg)("li",{parentName:"ul"},"using MATCH_ALL if you only need at least one of the keywords appears")))),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE comment LIKE '%OLAP%' OR comment LIKE '%OLTP%';\n+---------+\n| count() |\n+---------+\n|      68 |\n+---------+\n1 row in set (0.12 sec)\n\nmysql> SELECT count() FROM hackernews_1m WHERE comment MATCH_ANY 'OLAP OLTP';\n+---------+\n| count() |\n+---------+\n|      71 |\n+---------+\n1 row in set (0.01 sec)\n")),(0,r.yg)("h4",{id:"normal-equal-range-query"},"Normal equal, range query"),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"range query on DateTime column")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE timestamp > '2007-08-23 04:17:00';\n+---------+\n| count() |\n+---------+\n|  999081 |\n+---------+\n1 row in set (0.03 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"add inverted index for timestamp column")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- for timestamp column, there is no need for word parser, so just USING INVERTED without PROPERTIES\n-- this is the first syntax for CREATE INDEX\nmysql> CREATE INDEX idx_timestamp ON hackernews_1m(timestamp) USING INVERTED;\nQuery OK, 0 rows affected (0.03 sec)\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"After version 2.0.0 (including 2.0.0), you need to execute ",(0,r.yg)("inlineCode",{parentName:"strong"},"BUILD INDEX")," to add inverted index to the stock data:")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> BUILD INDEX idx_timestamp ON hackernews_1m;\nQuery OK, 0 rows affected (0.01 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"progress of building index can be view by SQL. It just costs 1s (compare FinishTime and CreateTime) to BUILD INDEX for timestamp column with 1 million rows.")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n1 row in set (0.00 sec)\n")),(0,r.yg)("p",null,(0,r.yg)("strong",{parentName:"p"},"After version 2.0.0 (including 2.0.0), you can view the progress of stock data creating index by ",(0,r.yg)("inlineCode",{parentName:"strong"},"SHOW BUILD INDEX"),":")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"-- If the table has no partitions, the PartitionName defaults to TableName\nmysql> SHOW BUILD INDEX;\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                                     | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 10191 | hackernews_1m | hackernews_1m | [ADD INDEX idx_timestamp (`timestamp`) USING INVERTED],  | 2023-06-26 15:32:33.894 | 2023-06-26 15:32:34.847 | 3             | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n1 row in set (0.04 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"after the index is build, Doris will automaticaly use index for range query, but the performance is almost the same since it's already fast on the small dataset")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE timestamp > '2007-08-23 04:17:00';\n+---------+\n| count() |\n+---------+\n|  999081 |\n+---------+\n1 row in set (0.01 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"similary test for parent column with numeric type, using equal query")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE parent = 11189;\n+---------+\n| count() |\n+---------+\n|       2 |\n+---------+\n1 row in set (0.01 sec)\n\n-- do not use word parser for numeric type USING INVERTED\n-- use the second syntax ALTER TABLE\nmysql> ALTER TABLE hackernews_1m ADD INDEX idx_parent(parent) USING INVERTED;\nQuery OK, 0 rows affected (0.01 sec)\n\n-- After version 2.0.0 (including 2.0.0), you need to execute `BUILD INDEX` to add inverted index to the stock data:\nmysql> BUILD INDEX idx_parent ON hackernews_1m;\nQuery OK, 0 rows affected (0.01 sec)\n\nmysql> SHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n| 10053 | hackernews_1m | 2023-02-10 19:49:32.893 | 2023-02-10 19:49:33.982 | hackernews_1m | 10054   | 10008         | 1:378856428   | 4             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n\nmysql> SHOW BUILD INDEX;\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                               | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 11005 | hackernews_1m | hackernews_1m | [ADD INDEX idx_parent (`parent`) USING INVERTED],  | 2023-06-26 16:25:10.167 | 2023-06-26 16:25:10.838 | 1002          | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n1 row in set (0.01 sec)\n\nmysql> SELECT count() FROM hackernews_1m WHERE parent = 11189;\n+---------+\n| count() |\n+---------+\n|       2 |\n+---------+\n1 row in set (0.01 sec)\n")),(0,r.yg)("ul",null,(0,r.yg)("li",{parentName:"ul"},"for text column author, inverted index can also be used to speedup equal query")),(0,r.yg)("pre",null,(0,r.yg)("code",{parentName:"pre",className:"language-sql"},"mysql> SELECT count() FROM hackernews_1m WHERE author = 'faster';\n+---------+\n| count() |\n+---------+\n|      20 |\n+---------+\n1 row in set (0.03 sec)\n\n-- do not use any word parser for author to treat it as a whole\nmysql> ALTER TABLE hackernews_1m ADD INDEX idx_author(author) USING INVERTED;\nQuery OK, 0 rows affected (0.01 sec)\n\n-- After version 2.0.0 (including 2.0.0), you need to execute `BUILD INDEX` to add inverted index to the stock data:\nmysql> BUILD INDEX idx_author ON hackernews_1m;\nQuery OK, 0 rows affected (0.01 sec)\n\n-- costs 1.5s to BUILD INDEX for author column with 1 million rows.\nmysql> SHOW ALTER TABLE COLUMN;\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| JobId | TableName     | CreateTime              | FinishTime              | IndexName     | IndexId | OriginIndexId | SchemaVersion | TransactionId | State    | Msg  | Progress | Timeout |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n| 10030 | hackernews_1m | 2023-02-10 19:44:12.929 | 2023-02-10 19:44:13.938 | hackernews_1m | 10031   | 10008         | 1:1994690496  | 3             | FINISHED |      | NULL     | 2592000 |\n| 10053 | hackernews_1m | 2023-02-10 19:49:32.893 | 2023-02-10 19:49:33.982 | hackernews_1m | 10054   | 10008         | 1:378856428   | 4             | FINISHED |      | NULL     | 2592000 |\n| 10076 | hackernews_1m | 2023-02-10 19:54:20.046 | 2023-02-10 19:54:21.521 | hackernews_1m | 10077   | 10008         | 1:1335127701  | 5             | FINISHED |      | NULL     | 2592000 |\n+-------+---------------+-------------------------+-------------------------+---------------+---------+---------------+---------------+---------------+----------+------+----------+---------+\n\nmysql> SHOW BUILD INDEX order by CreateTime desc limit 1;\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| JobId | TableName     | PartitionName | AlterInvertedIndexes                               | CreateTime              | FinishTime              | TransactionId | State    | Msg  | Progress |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n| 13006 | hackernews_1m | hackernews_1m | [ADD INDEX idx_author (`author`) USING INVERTED],  | 2023-06-26 17:23:02.610 | 2023-06-26 17:23:03.755 | 3004          | FINISHED |      | NULL     |\n+-------+---------------+---------------+----------------------------------------------------+-------------------------+-------------------------+---------------+----------+------+----------+\n1 row in set (0.01 sec)\n\n-- equal qury on text field autor get 3x speedup\nmysql> SELECT count() FROM hackernews_1m WHERE author = 'faster';\n+---------+\n| count() |\n+---------+\n|      20 |\n+---------+\n1 row in set (0.01 sec)\n\n")))}c.isMDXComponent=!0}}]);