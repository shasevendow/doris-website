"use strict";(self.webpackChunkdoris_website=self.webpackChunkdoris_website||[]).push([[88486],{15680:(e,r,t)=>{t.d(r,{xA:()=>d,yg:()=>p});var n=t(296540);function o(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function i(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter((function(r){return Object.getOwnPropertyDescriptor(e,r).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var r=1;r<arguments.length;r++){var t=null!=arguments[r]?arguments[r]:{};r%2?i(Object(t),!0).forEach((function(r){o(e,r,t[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(t,r))}))}return e}function a(e,r){if(null==e)return{};var t,n,o=function(e,r){if(null==e)return{};var t,n,o={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||(o[t]=e[t]);return o}(e,r);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],r.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var m=n.createContext({}),s=function(e){var r=n.useContext(m),t=r;return e&&(t="function"==typeof e?e(r):l(l({},r),e)),t},d=function(e){var r=s(e.components);return n.createElement(m.Provider,{value:r},e.children)},g="mdxType",c={inlineCode:"code",wrapper:function(e){var r=e.children;return n.createElement(n.Fragment,{},r)}},u=n.forwardRef((function(e,r){var t=e.components,o=e.mdxType,i=e.originalType,m=e.parentName,d=a(e,["components","mdxType","originalType","parentName"]),g=s(t),u=o,p=g["".concat(m,".").concat(u)]||g[u]||c[u]||i;return t?n.createElement(p,l(l({ref:r},d),{},{components:t})):n.createElement(p,l({ref:r},d))}));function p(e,r){var t=arguments,o=r&&r.mdxType;if("string"==typeof e||o){var i=t.length,l=new Array(i);l[0]=u;var a={};for(var m in r)hasOwnProperty.call(r,m)&&(a[m]=r[m]);a.originalType=e,a[g]="string"==typeof e?e:o,l[1]=a;for(var s=2;s<i;s++)l[s]=t[s];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}u.displayName="MDXCreateElement"},667057:(e,r,t)=>{t.r(r),t.d(r,{assets:()=>m,contentTitle:()=>l,default:()=>c,frontMatter:()=>i,metadata:()=>a,toc:()=>s});var n=t(58168),o=(t(296540),t(15680));const i={title:"N-Gram BloomFilter Index",language:"en"},l=void 0,a={unversionedId:"table-design/index/ngram-bloomfilter-index",id:"table-design/index/ngram-bloomfilter-index",title:"N-Gram BloomFilter Index",description:"\x3c!--",source:"@site/docs/table-design/index/ngram-bloomfilter-index.md",sourceDirName:"table-design/index",slug:"/table-design/index/ngram-bloomfilter-index",permalink:"/docs/dev/table-design/index/ngram-bloomfilter-index",draft:!1,tags:[],version:"current",frontMatter:{title:"N-Gram BloomFilter Index",language:"en"},sidebar:"docs",previous:{title:"BloomFilter Index",permalink:"/docs/dev/table-design/index/bloomfilter"},next:{title:"Bitmap Index",permalink:"/docs/dev/table-design/index/bitmap-index"}},m={},s=[{value:"Create N-Gram BloomFilter index",id:"create-n-gram-bloomfilter-index",level:3},{value:"Show N-Gram BloomFilter index",id:"show-n-gram-bloomfilter-index",level:3},{value:"Drop N-Gram BloomFilter index",id:"drop-n-gram-bloomfilter-index",level:3},{value:"Modify N-Gram BloomFilter index",id:"modify-n-gram-bloomfilter-index",level:3},{value:"<strong>Some Notes about Doris NGram BloomFilter</strong>",id:"some-notes-about-doris-ngram-bloomfilter",level:3}],d={toc:s},g="wrapper";function c(e){let{components:r,...t}=e;return(0,o.yg)(g,(0,n.A)({},d,t,{components:r,mdxType:"MDXLayout"}),(0,o.yg)("p",null,"In order to improve the like query performance, the N-Gram BloomFilter index was implemented."),(0,o.yg)("admonition",{type:"tip"},(0,o.yg)("p",{parentName:"admonition"},"N-Gram BloomFilter indexing is supported starting from the Doris 2.0 version.")),(0,o.yg)("h3",{id:"create-n-gram-bloomfilter-index"},"Create N-Gram BloomFilter index"),(0,o.yg)("p",null,"During create table\uff1a"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sql"},'CREATE TABLE `table3` (\n  `siteid` int(11) NULL DEFAULT "10" COMMENT "",\n  `citycode` smallint(6) NULL COMMENT "",\n  `username` varchar(100) NULL DEFAULT "" COMMENT "",\n  INDEX idx_ngrambf (`username`) USING NGRAM_BF PROPERTIES("gram_size"="3", "bf_size"="256") COMMENT \'username ngram_bf index\'\n) ENGINE=OLAP\nAGGREGATE KEY(`siteid`, `citycode`, `username`) COMMENT "OLAP"\nDISTRIBUTED BY HASH(`siteid`) BUCKETS 10\nPROPERTIES (\n"replication_num" = "1"\n);\n')),(0,o.yg)("ul",null,(0,o.yg)("li",{parentName:"ul"},'PROPERTIES("gram_size"="3", "bf_size"="1024")\uff0cindicate the number of gram and bytes of bloom filter respectively.'),(0,o.yg)("li",{parentName:"ul"},"The number of grams is related to the actual query scenarios and is usually set to the length of most query strings. The byte size of the Bloom Filter can be determined through testing, and generally, a larger size leads to better filtering effects. You can start with 256 bytes for validation testing to see the results. However, a larger byte size will also increase the storage and memory cost of the index."),(0,o.yg)("li",{parentName:"ul"},"If the data cardinality is relatively high, the byte size does not need to be set too large. If the cardinality is not very high, the filtering effect can be improved by increasing the byte size.")),(0,o.yg)("h3",{id:"show-n-gram-bloomfilter-index"},"Show N-Gram BloomFilter index"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sql"},"show index from example_db.table3;\n")),(0,o.yg)("h3",{id:"drop-n-gram-bloomfilter-index"},"Drop N-Gram BloomFilter index"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sql"},"alter table example_db.table3 drop index idx_ngrambf;\n")),(0,o.yg)("h3",{id:"modify-n-gram-bloomfilter-index"},"Modify N-Gram BloomFilter index"),(0,o.yg)("p",null,"Add N-Gram BloomFilter Index for old column:"),(0,o.yg)("pre",null,(0,o.yg)("code",{parentName:"pre",className:"language-sql"},'alter table example_db.table3 add index idx_ngrambf(username) using NGRAM_BF PROPERTIES("gram_size"="3", "bf_size"="512")comment \'username ngram_bf index\' \n')),(0,o.yg)("h3",{id:"some-notes-about-doris-ngram-bloomfilter"},(0,o.yg)("strong",{parentName:"h3"},"Some Notes about Doris NGram BloomFilter")),(0,o.yg)("ol",null,(0,o.yg)("li",{parentName:"ol"},"NGram BloomFilter only support CHAR/VARCHAR/String column."),(0,o.yg)("li",{parentName:"ol"},"NGram BloomFilter index and BloomFilter index should be exclusive on same column"),(0,o.yg)("li",{parentName:"ol"},"The gram number and bytes of BloomFilter can be adjust and optimize. Like if gram is too small, you can increase the bytes of BloomFilter."),(0,o.yg)("li",{parentName:"ol"},"To find some query whether use the NGram BloomFilter index, you can check the query profile.")))}c.isMDXComponent=!0}}]);